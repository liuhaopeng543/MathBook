# 概率

### 基本概念

- 随机试验：对随机现象的实现和观察，用 $E$ 表示。

- 样本点：$E$ 的每个可能的基本结果，用 $\omega$ 表示。

- 样本空间：全体 $\omega$ 的集合，用 $\Omega$ 表示。

- 有限样本空间：若一个随机试验有 $n$ 个可能结果 $\omega_1,\omega_2,\dots,\omega_n$，则称样本空间 $\Omega=\set{\omega_1,\omega_2,\dots,\omega_n}$ 为有限样本空间 $\\$（ 即 $\Omega$ 为有限集 ）。

- 随机事件：$\Omega$ 的子集，简称事件，用大写字母 $A,B,C,\dots$ 表示，当且仅当 $A$ 中的某个样本点出现时，称事件 $A$ 发生。

- 基本事件：只包含一个样本点的事件。

- 必然事件：$\Omega$ 作为自身的子集，包含了所有样本点，在每次试验中总有一个样本点发生，即 $\Omega$ 总会发生。

- 不可能事件：$\varnothing$ 不含任何样本点，在每次试验中都不会发生，必然事件与不可能事件不具有随机性。

### 事件的关系和运算

|   事件的关系    |            含义             |                    符号表示                     |
| :-------------: | :-------------------------: | :---------------------------------------------: |
|      包含       | $A$ 发生 $\implies B$ 发生  |                 $A\subseteq B$                  |
| 并事件 / 和事件 |   $A$ 和 $B$ 至少一个发生   |              $A\bigcup B$ 或 $A+B$              |
| 交事件 / 积事件 |     $A$ 和 $B$ 同时发生     |              $A\bigcap B$ 或 $AB$               |
| 互斥 / 互不相容 |   $A$ 和 $B$ 不能同时发生   |            $A\bigcap B=\varnothing$             |
| 互为独立 | $A$ 和 $B$ 有且仅有一个发生 | $A\bigcap B=\varnothing$ 且 $A\bigcup B=\Omega$ |

如果 $A,B$ 互斥，记 $\bar{A},\bar{B}$ 分别为 $A,B$ 的对立事件。

若 $A\subseteq B$ 且 $B\subseteq A$，则事件 $A$ 和事件 $B$ 相等，$A=B$.

对于三个事件 $A,B,C$，$A\bigcup B\bigcup C$ 或 $A+B+C$ 表示 $A,B,C$ 至少一个发生，其余同理。

### 古典概型

- 满足有限性（ 有限样本空间 ）、等可能性。

- 设 $E$ 为古典概型，样本空间 $\Omega$ 包含 $n$ 个样本点，事件 $A$ 包含其中的 $k$ 个样本点，则事件 $A$ 的概率为 $\displaystyle P(A)=\frac{k}{n}=\frac{n(A)}{n(\Omega)} \\ n(A),n(\Omega)$ 表示事件 $A$ 和样本空间 $\Omega$ 包含的样本点个数。

### 概率的基本性质
    
1. $\forall A,0\leq P(A)\leq 1$.
2. 必然事件 $\Omega$ 概率为 $P(\Omega)=1$，不可能事件 $\varnothing$ 概率为 $P(\varnothing)=0$.
3. 若 $A,B$ 互斥，则 $P(A\bigcup B)=P(A)+P(B)$； $\\$ 推广：若 $A_1,A_2,\dots,A_m$ 两两互斥，则 $P(A_1\bigcup A_2\bigcup\dots\bigcup A_m)=\displaystyle\sum_{i=1}^{m}P(A_i)$
4. 若 $A,B$ 对立，则 $P(B)=1-P(A),P(A)=1-P(B)$；若 $P(A)+P(B)=1$，则 $A,B$ 不一定对立。
5. 若 $A\subseteq B$，则 $P(A)\leq P(B)$（ 概率的单调性 ）
6. 设 $A,B$ 为随机试验中的两个事件，则 $P(A\bigcup B)=P(A)+P(B)-P(A\bigcap B)$ （ 容斥原理 ）
7. 对任意 $2$ 个事件 $A,B$，若 $P(AB)=P(A)P(B)$，则 $A$ 与 $B$ 相互独立，记 $A,B$ 的对立事件分别为 $\bar{A},\bar{B}$ $\\$ 因事件 $A,B$ 的发生互不影响，则 $A$ 与 $\bar{B}$，$\bar{A}$ 与 $B$，$\bar{A}$ 与 $\bar{B}$ 也相互独立。
8. 若 $A,B,C$ 两两独立，则 $P(ABC)\neq P(A)P(B)P(C)$.
9. $\bar{A}\cap\bar{B}=\overline{A\cup B},\bar{A}\cup\bar{B}=\overline{A\cap B}$

|        事件含义         |      事件表示       |             概率             |   $A,B$ 互斥    |         $A,B$ 相互独立          |
| :---------------------: | :-----------------: | :--------------------------: | :-------------: | :-----------------------------: |
| $A$ 和 $B$ 至少一个发生 |    $A\bigcup B$     |       $P(A\bigcup B)$        |   $P(A)+P(B)$   |    $1-P(\bar{A})P(\bar{B})$     |
|   $A$ 和 $B$ 同时发生   |        $AB$         |           $P(AB)$            |       $0$       |           $P(A)P(B)$            |
|   $A$ 和 $B$ 都不发生   |  $\bar{A}\bar{B}$   |     $P(\bar{A}\bar{B})$      | $1-[P(A)+P(B)]$ |     $P(\bar{A})P(\bar{B})$      |
| $A$ 和 $B$ 只有一个发生 | $A\bar{B}+\bar{A}B$ | $P(A\bar{B}\bigcup\bar{A}B)$ |   $P(A)+P(B)$   | $P(A)P(\bar{B})+P(\bar{A})P(B)$ |

### 条件概率

一般地，设 $A,B$ 为两个随机事件，且 $P(A)>0$，那么

$$P(B|A)=\frac{P(AB)}{P(A)}$$

表示在事件 $A$ 发生的条件下，事件 $B$ 发生的概率。

反过来，对任意两个事件 $A,B$，若 $P(A)>0$，则有概率的乘法公式：

$$P(AB)=P(A)P(B|A)$$

条件概率具有的性质：

1. $P(\Omega|A)=1$.
2. 如果 $B,C$ 互斥，则 $P(B\bigcup C|A)=P(B|A)+P(C|A)$.
3. $P(\bar B|A)=1-P(B|A)$.
4. 已知 $P(A)>0,P(B)>0,P(B|A)=P(B)$，则 $P(A|B)=P(A)$.
5. 当 $P(AB)>0$ 时，$P(ABC)=P(A)P(B|A)P(C|AB)$. 推广开来，
   $$P(A_1A_2\dots A_n)=P(A_1)P(A_2|A_1)P(A_3|A_1A_2)\dots P(A_n|A_1A_2\dots A_{n-1})$$


### 全概率公式

设 $A_1,A_2,\dots,A_n$ 是两两互斥的事件且 $A_1\bigcup A_2\bigcup \dots\bigcup A_n=\Omega$ 且 $P(A_i)>0,i=1,2,\dots,n$，则对任意事件 $B\sube\Omega$ 有：

$$P(B)=\sum_{i=1}^nP(A_i)P(B|A_i)$$

教材例题：有 $3$ 台车床加工同一型号的零件，第 $1$ 台加工的次品率为 $6\%$，其余两台均为 $5\%$，加工出来的零件混放在一起。已知第 $1,2,3$ 台车床加工的零件数分别占总数的 $25\%,30\%,45\%$.

$(1)$ 任取一个零件，计算它是次品的概率。
$(2)$ 如果取到的是次品，计算它是第 $i(i=1,2,3)$ 台机床加工的概率。

解析：设 $B=$ “任取一个零件为次品”，$A_i=$ “零件为第 $i$ 台车床加工”，则  $\Omega=A_1\bigcup A_2\bigcup A_3$ 且 $A_1,A_2,A_3$ 两两互斥，根据题意有

$$P(A_1)=0.25,P(A_2)=0.3,P(A_3)=0.45$$

$$P(B|A_1)=0.06,P(B|A_2)=P(B|A_3)=0.05$$

$(1)$ 由全概率公式，

$$P(B)=P(A_1)P(B|A_1)+P(A_2)P(B|A_2)+P(A_3)P(B|A_3)=0.0525$$

$(2)$ $\displaystyle P(A_1|B)=\frac{P(A_1B)}{P(B)}=\frac{2}{7}$，同理 $\displaystyle P(A_2|B)=\frac{2}{7},P(A_3|B)=\frac{3}{7}$.

---

将上题中 $(2)$ 一般化可以得到贝叶斯公式：（ 这部分为人教版选学内容 ）

设 $A_1,A_2,\dots,A_n$ 是两两互斥的事件且 $A_1\bigcup A_2\bigcup \dots\bigcup A_n=\Omega$ 且 $P(A_i)>0,i=1,2,\dots,n$，则对任意事件 $B\sube\Omega,P(B)>0$ 有：

$$P(A_i|B)=\frac{P(A_i)P(B|A_i)}{P(B)}=\frac{P(A_i)P(B|A_i)}{\displaystyle\sum_{k=1}^nP(A_k)P(B|A_k)}$$

### 离散型随机变量及其分布列

一般地，对于随机试验样本 $\Omega$ 中的每个样本点 $\omega$，都有唯一的实数 $X(\omega)$ 与之对应，我们称 $X$ 为随机变量。而可能取值为有限个的随机变量称之为 **离散型随机变量**。用大写字母表示随机变量，用小写字母表示随机变量的取值。

例如，投一枚质地均匀的骰子，事件抛出 $m$ 点可以表示为 $\set{X=m}(m=1,2,3,4,5,6)$，并且有 $\displaystyle P(X=m)=\frac{1}{6}$.

一般地，设离散型随机变量 $X$ 的可能取值为 $x_1,x_2,\dots,x_n$，我们称 $X$ 取每一个值的概率

$$P(X=x_i)=p_i\ \ \ \ \ \ \ \ \ \ i=1,2,3,\dots,n,\sum_{i=1}^n p_i=1$$

为 $X$ 的（ 概率 ）分布列。可以列出 $X$ 的概率分布图：

| $X$  | $x_1$  | $x_2$  | $\dots$  | $x_n$  |
|:-:|:-:|:-:|:-:|:-:|
| $P$  | $p_1$  | $p_2$  | $\dots$  | $p_n$  |

称 $X$ 服从 **两点分布 / $0-1$ 分布**，当且仅当 $n=2$，并且有：

| $X$  | $0$  | $1$  |
|:-:|:-:|:-:|
| $P$  | $p$  | $1-p$  |

- 数学期望：即加权平均数。

$$E(X)=\sum_{i=1}^nx_ip_i$$

- 方差：

$$\begin{aligned}D(X)&=\sum_{i=1}^n(x_i-E(X))^2p_i=\sum_{i=1}^n[x_i^2-2E(X)x_i+E(X)^2]p_i\\&=\sum_{i=1}^nx_i^2p_i-2E(X)\sum_{i=1}^nx_ip_i+E(X)^2\sum_{i=1}^np_i\\&=\sum_{i=1}^nx_i^2p_i-E(X)^2\end{aligned}$$

性质：

$$D(aX+b)=a^2D(X)$$

- 伯努利试验：只包含两个可能结果的试验。独立重复的做 $n$ 次 $\to n$ 重伯努利试验。在 $n$ 重伯努利试验中，设每次试验中事件 $A$ 发生的概率为 $p(0<p<1)$，用 $X$ 表示事件 $A$ 发生的次数，则 $X$ 的分布列为

$$P(X=k)=C_n^kp^k(1-p)^{n-k}\ \ \ \ \ \ \ k=0,1,2,\dots,n$$

如果随机变量 $X$ 的分布列满足上式，称随机变量 $X$ 服从**二项分布**，记作 $X\sim B(n,p)$. 由二项式定理可得

$$\sum_{k=0}^nP(X=k)=\sum_{k=0}^nC_n^kp^k(1-p)^{n-k}=[p+(1-p)]^n=1$$

例题：将一枚质地均匀硬币投掷 $10$ 次，求

$(1)$ 恰好 $5$ 次正面朝上的概率。

记 $A=$ 正面朝上，$P(A)=0.5$，记 $X$ 表示 $A$ 发生的次数，则 $X\sim B(10,0.5)$.

$$P(X=5)=C_{10}^5\times 0.5^{10}=\frac{63}{256}$$

$(2)$ 正面朝上出现的频率在 $[0.4,0.6]$ 之间的概率。

$$P(4\leq X\leq 6)=C_{10}^4\times 0.5^{10}+C_{10}^5\times 0.5^{10}+C_{10}^6\times 0.5^{10}=\frac{21}{32}$$

- 二项分布的性质：

$$\begin{aligned}E(X)&=\sum_{k=0}^nkC_n^kp^k(1-p)^{n-k}=\sum_{k=1}^nnC_{n-1}^{k-1}p^k(1-p)^{n-k}\\&=np\sum_{k=1}^nkC_{n-1}^{k-1}p^{k-1}(1-p)^{n-1-(k-1)}\ \ \ \ \ \ \ \ \ \ \ k-1=m\\&=np\sum_{m=0}^{n-1}C_{n-1}^{m}p^m(1-p)^{n-1-m}=np(p+1-p)^{n-1}=\boxed{np}\end{aligned}$$

$$\boxed{D(X)=np(1-p)}$$

- **超几何分布**：一般地，假设一批产品共 $N$ 件，其中有 $M\leq N$ 件次品。从 $N$ 件产品中随机不放回抽取 $n\leq N$ 件，用 $X$ 表示抽取的次品数，则

$$P(X=k)=\frac{C_M^kC^{n-k}_{N-M} }{C_N^n}\ \ \ \ \ \ \ \ \ \ \ k=\max\set{0,n-N+M}\sim\min\set{n,M}$$

$$\boxed{E(X)=\frac{nM}{N} \ \ \ \ \ \ \ \ \ D(X)=\frac{nM(N-M)(N-n)}{N^2(N-1)}}$$

与二项分布相比，超几何分布更集中在均值附近。

例 1：从 $50$ 名学生中随机选 $5$ 人，求甲被选中的概率。

设 $X$ 表示选出的 $5$ 名学生中含甲的人数（ $0$ 或 $1$ ），

$$P(X=1)=\frac{C_1^1C_{49}^4}{C_{50}^5}=\frac{1}{10}$$

例 2：$30$ 个零件有 $3$ 个不合格。随机抽 $10$ 个有至少 $1$ 个不合格的概率 ？

设 $X$ 表示抽取的 $10$ 个零件中不合格的数量，

$$P(X=k)=\frac{C_3^kC_{27}^{10-k} }{C_{30}^{10} }\ \ \ \ \ \ k=0,1,2,3$$

$$P(X\geq 1)=1-P(X=0)=1-\frac{C_3^0C_{27}^{10} }{C_{30}^{10} }\approx 0.7192$$

### 正态分布

前提：研究连续型随机变量。

正态分布解析式：

$$\large f(x)=\frac{1}{\sigma\sqrt{2\pi} }e^{-\frac{(x-\mu)^2}{2\sigma^2} }$$

其中 $\mu\in\R,\sigma >0$ 为参数。对 $\forall x\in\R,f(x)>0$，可以用积分证明 $x$ 轴与曲线之间的区域面积为 $1$。称 $f(x)$ 为正态密度函数，图像为正态（ 密度 ）曲线。$X$ 服从正态分布，记为 $X\sim N(\mu,\sigma^2)$. 特别地，当 $\mu=0,\sigma=1$ 时称 $X$ 服从标准正态分布。

特点：曲线是单峰的，关于 $x=\mu$ 对称；在 $x=\mu$ 达到峰值 $\displaystyle\frac{1}{\sigma\sqrt{2\pi}}$；$\displaystyle\lim_{|x|\to\infty}f(x)=0$. 
当 $\sigma$ 较小时，曲线“瘦高”，反之“矮胖”。

$$E(X)=\mu\ \ \ \ \ \ \ D(X)=\sigma^2$$

$$P(\mu-\sigma\leq X\leq \mu+\sigma)\approx 0.6827$$

$$P(\mu-1.96\sigma\leq X\leq \mu+1.96\sigma)=0.95$$

$$P(\mu-2\sigma\leq X\leq \mu+2\sigma)\approx 0.9545$$

$$P(\mu-2.58\sigma\leq X\leq \mu+2.58\sigma)=0.99$$

$$P(\mu-3\sigma\leq X\leq \mu+3\sigma)\approx 0.9973$$

$3\sigma$ 原则：服从于正态分布 $N(\mu,\sigma^2)$ 的随机变量只取 $[\mu-3\sigma,\mu+3\sigma]$ 中的值。

### 马尔科夫链

#### 一维随机游走

先来一道简单题，赌徒问题：你有本金 $A$ 元，每赌博一局，有 $50\%$ 概率赢得 $1$ 元，有 $50\%$ 概率输掉 $1$ 元，你会一直赌下去除非①没钱②达到期望 $B$ 元。记赌徒现在有 $n$ 元，求最终输光的概率 $P(n)$。上述 $A,B,n\in\N^*$.

很明显你现在有 $n$ 元进行一局后就是 $n\pm 1$ 元，两者概率相同。故 $$P(n)=\frac{1}{2}P(n-1)+\frac{1}{2}P(n+1)\implies P(n)=1-\frac{n}{B}$$

如果概率不相同，那么也很容易写出，略。（ 其实就是一维随机游走 ）

另外还有失足问题：一个醉鬼走在一头是悬崖（ 设悬崖处于 $0$ 的位置 ）的道路上，他的初始位置为 $n$，向左或向右走一步的概率都是 $\displaystyle\frac{1}{2}$，问他失足掉入悬崖的概率是多少？

答案是 $1$。因为你经过无限多次总会到达 $0$ 点。

变式：在数轴上，一个质点从 $x=0$ 位置出发随机游走，每次游走等可能地向左或向右移动 $1$ 个单位长度，求游走 $n$ 次后回到出发点的概率 $p_n$.

$\displaystyle p_{2n-1}=0,\ p_{2n}=\frac{C_{2n}^n}{4^n}$. 质点向左向右的次数必须相等。

#### 二维随机游走

【2024 山东名校联盟二模 T19】随机游走在空气中的烟雾扩散、股票市场的价格波动等动态随机现象中有重要应用,在平面直角坐标系中，粒子从原点出发，每秒向左、向右、向上或向下移动一个单位，且向四个方向移动的概率均为 $\displaystyle\frac{1}{4}$，例如在 $1s$ 末，粒子会等可能地出现在 $(1,0),(-1,0),(0,1),(0,-1)$ 四个位置。

$(2)$ 记第 $n$ 秒末粒子回到原点的概率是 $p_n$。已知 $\displaystyle\sum_{k=0}^n(C_n^k)^2=C_{2n}^n$，求 $p_3,p_4,p_{2n}$.

$(3)$ 令 $b_n=p_{2n}$，记 $S_n$ 为数列 $\set{b_n}$ 的前 $n$ 项和，若对任意实数 $M>0$，存在 $n\in\N^*$ 使得 $S_n>M$，则称粒子是常返的。已知 $\displaystyle\sqrt{2\pi n}\left(\frac{n}{e}\right)^n<n!<\left(\frac{6}{\pi}\right)^{\frac{1}{4}}\sqrt{2\pi n}\left(\frac{n}{e}\right)^n$，证明，该粒子是常返的。

解：$(2)$ 显然 $p_{2n-1}=0$. 第 $2n$ 秒末要到原点，那么必定向左向右移动 $k$ 步，向上向下移动 $n-k$ 步，有

$$p_{2n}=\sum_{k=0}^n\frac{C_{2n}^k C_{2n-k}^k C_{2n-2k}^{n-k} }{4^{2n} }=\frac{1}{4^{2n}}\sum_{k=0}^{n}\frac{(2n)!}{(k!)^2[(n-k)!]^2}=\frac{(2n)!}{4^{2n}(n!)^2}\sum_{k=0}^{n}\frac{(n!)^2}{(k!)^2[(n-k)!]^2}\\=\frac{1}{4^{2n}}C_{2n}^n\sum_{k=0}^n C_n^kC_{n}^{n-k}=\frac{(C_{2n}^n)^2}{4^{2n}}=\frac{[(2n)!]^2}{16^n(n!)^4}$$

$(3)\ \displaystyle C_{2n}^n=\frac{(2n)!}{(n!)^2}>\frac{\sqrt{4\pi n}(\frac{2n}{e})^{2n}}{[(\frac{6}{\pi})^{\frac{1}{4}}\sqrt{2\pi n}(\frac{n}{e})^n]^2}=\frac{4^n}{\sqrt{6n}}\implies b_n>\frac{1}{6n}>\frac{1}{6}\ln\frac{n+1}{n}\implies S_n>\frac{1}{6}\ln(n+1)$，这是发散的，证毕。

备注：给出的提示是 $\text{Stirling}$ 斯特林公式 $\displaystyle n!\approx\sqrt{2\pi n}\left(\frac{n}{e}\right)^n$.

#### 马尔科夫链

我们可以看到，上述问题的解决，是在一个当前的状态下，去判断前一个时刻的状态或者是后一个时刻的状态与当前状态的联系，从而找到递推式。

马尔可夫链有点类似于这样子，但它是在考虑这样的一个马尔可夫过程，过程中的**每个状态的转移只依赖于之前的 $n$ 个状态**（ 动态规划的最优子结构性质？），这个过程被称为 $n$ 阶马尔可夫模型。（ 其中 $n$ 是影响转移的状态数目 ）

最简单的马尔科夫过程就是一阶过程，每一个状态的转移只依赖于其之前的那一个状态，这也是后面很多模型的讨论基础。

【2023 广东惠州一模】你只能吃饭或者吃面。第 $1$ 天吃饭的概率是 $\displaystyle\frac{2}{3}$，而前一天吃饭后一天继续吃饭的概率是 $\displaystyle\frac{1}{4}$，前一天吃面后一天继续吃面的概率是 $\displaystyle\frac{1}{2}$. 记第 $n$ 天吃饭概率为 $P_n$，求通项并证明 $n\geq 2$ 时 $\displaystyle P_n\leq\frac{5}{12}$.

$$P_1=\frac{2}{3}\ \ \ \ \ \ \ \ \ P_{n+1}=\frac{1}{4}P_n+\frac{1}{2}(1-P_n)=-\frac{1}{4}P_n+\frac{1}{2}\\\implies P_{n+1}-\frac{2}{5}=-\frac{1}{4}\left(P_n-\frac{2}{5}\right)\implies P_n=\frac{4}{15}\left(-\frac{1}{4}\right)^{n-1}+\frac{2}{5}$$


环状的马尔可夫：【2025 广州一模】$n(n\in\N^*,n\geq 3)$ 个人相互传球，传球规则如下：若球从甲手中传出，则甲传给乙；否则，传球者等可能地将球传给另外的 $n-1$ 个人的任何一个。第一次传球由甲手中传出，第 $k(k\in\N^*)$ 次传球后，球在甲手中的概率记为 $A_n(k)$，球在乙手中的概率记为 $B_n(k)$.

$(1)$ 求 $A_5(2),B_5(2),A_5(3),B_5(3)$；$(2)$ 求 $A_n(k)$；$(3)$ 比较 $B_n(k+1)$ 与 $\displaystyle\frac{n-2}{n-1}A_n(k)$ 的大小。

$$A_n(1)=0\ \ \ \ \ \ \ \ A_n(k+1)=\frac{1}{n-1}[1-A_n(k)]\implies A_n(k)=\frac{1}{n}\left[1-\left(-\frac{1}{n-1}\right)^{k-1}\right]$$

$$B_n(k+1)=A_n(k)+\frac{1}{n-1}[1-A_n(k)-B_n(k)]\implies B_n(k+1)=\frac{n-2}{n-1}A_n(k)+\frac{1}{n-1}-\frac{B_n(k)}{n-1}$$

$$B_n(k+1)-\frac{n-2}{n-1}A_n(k)=\frac{1}{n-1}[1-B_n(k)]\geq 0$$

当且仅当 $k=1$ 时取等。这是个比较难算的题。更难的题目见 [here](https://zhuanlan.zhihu.com/p/1695634769)

---

一个平面的俯视图为一个 $3\times 3$ 的方格表。初始时在中心位置有一个电子瓢虫，每过一秒钟随机向上下左右移动一个单位，跌落平台就会死亡。那么在 $2023$ 秒后，仍然存活的概率是 ？

设第 $n$ 秒后瓢虫在中心的概率是 $z_n$，在角的概率是 $j_n$，在边中间的概率是 $b_n$，于是

$$z_1=0,j_1=0,b_1=1\ \ \ \ z_2=\frac{1}{4},j_2=\frac{1}{2},b_2=0$$

$$\begin{cases}\displaystyle z_n=\frac{1}{4}b_{n-1}\\\displaystyle j_n=\frac{1}{2}b_{n-1} \\\displaystyle b_n=z_{n-1}+\frac{1}{2}j_{n-1}\end{cases}\implies b_{n+1}=z_n+\frac{1}{2}j_n=\frac{1}{2}b_{n-1}\implies b_{2023}=\frac{1}{2^{1011}},b_{2022}=0$$

显然答案为 $\displaystyle\frac{1}{2^{1011}}$.

<!-- 
连续抛 $10$ 枚硬币，出现连续 $5$ 次及以上正面朝上的概率为 ？

$\displaystyle\text{A}. \frac{15}{128}\ \ \text{B}. \frac{29}{256}\ \ \text{C}. \frac{7}{64}\ \ \text{D}. \frac{5}{32}$


正难则反，考虑不出现连续 $5$ 次正面朝上的情况。定义状态 `dp[i][j]` 表示前 $i$ 次抛硬币中，最后 $j$ 次都是正面，并且从未出现过连续 $5$ 次正面的情况。其中 $j\in\set{0,1,2,3,4}$。我们有

- $dp[i][0]=\displaystyle\sum_{j=0}^4 dp[i-1][j]$  第 $i$ 次抛反面，连续正面次数归零。

- $j\geq 1$ 时，$dp[i][j]=dp[i-1][j-1]$ 第 $i$ 次抛正面，连续正面次数 $+1$。

初始条件：$dp[0][0]=1$。好了我们启动计算机计算得到 $\displaystyle\sum_{j=0}^4 dp[10][j]=912$，于是答案为 $\displaystyle1-\frac{912}{2^{10}}=\frac{7}{64}$ -->

---

【2024 武汉部分学校调研】$n$ 个盒子 $k$ 个球，$n\geq 2,n\in\N^*$ 且 $2\leq k\leq n,k\in\N$. 规则如下：每个盒子最多放一个球。先将 $1$ 号球随机放在任意一个盒子中，剩下的球从小到大依次放置。若球的编号对应的盒子为空，则放进去；否则随机挑一个空盒子放进去。记 $k$ 号球能放入 $k$ 号盒子的概率为 $P(n,k)$.

$(1)$ 求 $P(3,3)$；$(2)$ 当 $n\geq 3$ 时，求 $P(n,3)$；$(3)$ 求 $P(n,k)$.

答案：$\displaystyle (1)\ \frac{1}{2}\ \ (2)\ \frac{n-2}{n-1}\ \ (3)\ \frac{n-k+1}{n-k+2}$.

解析：$(3)$ 先考虑 $1$ 号球放在 $1$ 号或 $k+1$ 到 $n$ 号盒子里，这部分概率为 $\displaystyle\frac{n-k+1}{n}$.
 
再考虑 $1$ 号球放 $j\in[2,k-1]$ 号盒子，概率为 $\displaystyle\frac{1}{n}$，此时 $2$ 号到 $j-1$ 号球正常放，剩下 $j,j+1,j+2,\dots,k$ 号球放 $1,j+1,j+2,\dots,n$ 的空盒，$k$ 号球能放入 $k$ 号盒子的概率相当于 $P(n-j+1,k-j+1)$.

$$P(n,k)=\frac{n-k+1}{n}+\frac{1}{n}\sum_{j=2}^{k-1}P(n-j+1,k-j+1)$$

$$\implies nP(n,k)=n-k+1+\sum_{j=2}^{k-1}P(n-j+1,k-j+1)$$

$$(n-1)P(n-1,k)=n-k+\sum_{j=2}^{k-1}P(n-j,k-j+1)$$

相减得 $\displaystyle P(n,k)=P(n-1,k-1)=\dots=P(n-k+2,2)=\frac{n-k+1}{n-k+2}$.

### 其他好题

甲、乙两人玩游戏。规则如下：奇数局甲赢的概率是 $\displaystyle\frac{3}{4}$，偶数局乙赢的概率是 $\displaystyle\frac{3}{4}$. 没有平局。规定：当一个人赢的局数比另一个人赢的局数多 $2$ 次时游戏结束。求游戏结束时甲、乙两人玩的游戏局数的数学期望。

设玩 $X$ 局，则期望为 $E(X)$。显然 $\displaystyle P(X=2)=\frac{3}{4}\times\frac{1}{4}\times 2=\frac{3}{8}.\ \text{}$否则前两局的比分为 $1:1$，相当于 $0:0$ 的情况，只不过多比了 $2$ 次。所以 $$E(X)=\frac{3}{8}\times 2+\left(1-\frac{3}{8}\right)\times[E(X)+2]\implies E(X)=\frac{16}{3}$$